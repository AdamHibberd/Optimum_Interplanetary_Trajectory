<HTML>
<HEAD>
<TITLE> Geometric Event Finding Hands-On Lesson, using MEX (C) </TITLE>
</HEAD>

<BODY style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">

<A NAME="top"></A>

<TABLE STYLE="text-align: left; margin-left: auto; margin-right: auto; width: 800px;" BORDER="0" CELLPADDING="5" CELLSPACING="2">
<TBODY>
<TR>
  <TD STYLE="background-color: rgb(153, 153, 153); vertical-align: middle; text-align: center;">
  <DIV ALIGN="right">
    <SMALL><SMALL><a href="../index.html">Main Page</a></SMALL></SMALL>
  </DIV>
  <B>Geometric Event Finding Hands-On Lesson, using MEX (C)</B> </TD>
</TR>
<TR>
  <TD STYLE="vertical-align: top;">

<H2> Table of Contents
</H2>

<PRE>
   <A HREF="#Geometric Event Finding Hands-On Lesson, using MEX (C)">Geometric Event Finding Hands-On Lesson, using MEX (C)</A>
      <A HREF="#Overview">Overview</A>
      <A HREF="#Note About HTML Links">Note About HTML Links</A>
      <A HREF="#References">References</A>
         <A HREF="#Tutorials">Tutorials</A>
         <A HREF="#Required Readings">Required Readings</A>
         <A HREF="#The Permuted Index">The Permuted Index</A>
         <A HREF="#API Documentation">API Documentation</A>
      <A HREF="#Kernels Used">Kernels Used</A>
      <A HREF="#CSPICE Modules Used">CSPICE Modules Used</A>
   <A HREF="#Find View Periods">Find View Periods</A>
      <A HREF="#Task Statement">Task Statement</A>
      <A HREF="#Learning Goals">Learning Goals</A>
      <A HREF="#Approach">Approach</A>
         <A HREF="#Solution steps">Solution steps</A>
      <A HREF="#Solution">Solution</A>
         <A HREF="#Solution Meta-Kernel">Solution Meta-Kernel</A>
         <A HREF="#Solution Code">Solution Code</A>
         <A HREF="#Solution Sample Output">Solution Sample Output</A>
   <A HREF="#Find Times when Target is Visible">Find Times when Target is Visible</A>
      <A HREF="#Task Statement0">Task Statement</A>
      <A HREF="#Learning Goals0">Learning Goals</A>
      <A HREF="#Approach0">Approach</A>
         <A HREF="#Solution steps0">Solution steps</A>
      <A HREF="#Solution0">Solution</A>
         <A HREF="#Solution Meta-Kernel0">Solution Meta-Kernel</A>
         <A HREF="#Solution Code0">Solution Code</A>
         <A HREF="#Solution Sample Output0">Solution Sample Output</A>
   <A HREF="#Extra Credit">Extra Credit</A>
      <A HREF="#Task statements">Task statements</A>
      <A HREF="#Solutions">Solutions</A>

</PRE>

<HR SIZE=3 NOSHADE>

<BR><BR>
<A NAME="Geometric Event Finding Hands-On Lesson, using MEX (C)"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H1> Geometric Event Finding Hands-On Lesson, using MEX (C)
</H1><HR SIZE=3 NOSHADE><P><BR><BR><BR>
   November 02, 2017
<P>
 
<BR><BR>
<A NAME="Overview"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Overview
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   This lesson illustrates how the Geometry Finder (GF) subsystem of the
   CSPICE Toolkit can be used to find time intervals when specified
   geometric conditions are satisfied.
<P>
 
   In this lesson the student is asked to construct a program that finds
   the time intervals, within a specified time range, when the Mars Express
   Orbiter (MEX) is visible from the DSN station DSS-14. Possible
   occultation of the spacecraft by Mars is to be considered.
<P>
 
<BR><BR>
<A NAME="Note About HTML Links"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Note About HTML Links
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   The HTML version of this lesson contains links pointing to various HTML
   documents provided with the Toolkit. All of these links are relative
   and, in order to function, require this document to be in a certain
   location in the Toolkit HTML documentation directory tree.
<P>
 
   In order for the links to be resolved, if not done already by installing
   the lessons package under the Toolkit's ``doc/html'' directory, create a
   subdirectory called ``lessons'' under the ``doc/html'' directory of the
   ``cspice/'' tree and copy this document to that subdirectory before
   loading it into a Web browser.
<P>
 
<BR><BR>
<A NAME="References"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> References
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   This section lists SPICE documents referred to in this lesson.
<P>
 
   Of these documents, the ``Tutorials'' contains the highest level
   descriptions with the least number of details while the ``Required
   Reading'' documents contain much more detailed specifications. The most
   complete specifications are provided in the ``API Documentation''.
<P>
 
   In some cases the lesson explanations also refer to the information
   provided in the meta-data area of the kernels used in the lesson
   examples. It is especially true in case of the FK and IK files, which
   often contain comprehensive descriptions of the frames, instrument FOVs,
   etc. Since both FK and IK are text kernels, the information provided in
   them can be viewed using any text editor, while the meta information
   provided in binary kernels -- SPKs and CKs -- can be viewed using
   ``commnt'' or ``spacit'' utility programs located in ``cspice/exe'' of
   Toolkit installation tree.
<P>
 
<BR><BR>
<A NAME="Tutorials"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Tutorials
</H3><P><BR><BR>
   The following SPICE tutorials serve as references for the discussions in
   this lesson:
<P>
 
<PRE>
 
   Name              Lesson steps/functions it describes
   ----------------  -----------------------------------------------
   Time              Time Conversion
   SCLK and LSK      Time Conversion
   SPK               Obtaining Ephemeris Data
   Frames            Reference Frames
   Using Frames      Reference Frames
   PCK               Planetary Constants Data
   Lunar-Earth PCK   Lunar and Earth Orientation Data
   GF                The SPICE Geometry Finder (GF) subsystem
</PRE>
   These tutorials are available from the NAIF ftp server at JPL:
<P>
 
<PRE>
   <a href="http://naif.jpl.nasa.gov/naif/tutorials.html">http://naif.jpl.nasa.gov/naif/tutorials.html</a>
</PRE>
<BR><BR>
<A NAME="Required Readings"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Required Readings
</H3><P><BR><BR>
   The Required Reading documents are provided with the Toolkit and are
   located under the ``cspice/doc'' directory in the CSPICE Toolkit
   installation tree.
<P>
 
<PRE>
   Name             Lesson steps/functions that it describes
   ---------------  -----------------------------------------
   <a href="../req/cells.html">cells.req</a>        Cell/window initialization
   <a href="../req/frames.html">frames.req</a>       Using reference frames
   <a href="../req/gf.html">gf.req</a>           The SPICE geometry finder (GF) subsystem
   <a href="../req/kernel.html">kernel.req</a>       Loading SPICE kernels
   <a href="../req/naif_ids.html">naif_ids.req</a>     Body and reference frame names
   <a href="../req/pck.html">pck.req</a>          Obtaining planetary constants data
   <a href="../req/spk.html">spk.req</a>          Computing positions and velocities
   <a href="../req/time.html">time.req</a>         UTC to ET time conversion
   <a href="../req/windows.html">windows.req</a>      The SPICE window data type
</PRE>
<BR><BR>
<A NAME="The Permuted Index"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> The Permuted Index
</H3><P><BR><BR>
   Another useful document distributed with the Toolkit is the permuted
   index. This is located under the ``cspice/doc'' directory in the C
   installation tree.
<P>
 
   This text document provides a simple mechanism by which users can
   discover which CSPICE functions perform functions of interest, as well
   as the names of the source files that contain these functions.
<P>
 
<BR><BR>
<A NAME="API Documentation"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> API Documentation
</H3><P><BR><BR>
   The most detailed specification of a given SPICE C routine is contained
   in the header section of its source code. The source code is distributed
   with the Toolkit and is located under the ``cspice/src/cspice'' path.
<P>
 
   For example the path of the source code of the <a href="../cspice/str2et_c.html">str2et_c</a> routine is
<P>
 
<PRE>
   cspice/src/cspice/<a href="../cspice/str2et_c.html">str2et_c</a>.c
</PRE>
<BR><BR>
<A NAME="Kernels Used"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Kernels Used
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   The following kernels are used in examples provided in this lesson:
<P>
 
<PRE>
   #  FILE NAME                      TYPE DESCRIPTION
   -- ------------------------------ ---- ------------------------------
   1  de405xs.bsp                    SPK  Planetary ephemeris SPK,
                                          subsetted to cover only time
                                          range of interest
   2  earthstns_itrf93_050714.bsp    SPK  DSN station SPK
   3  earth_topo_050714.tf           FK   DSN station frame definitions
   4  earth_000101_060525_060303.bpc PCK  Binary PCK for Earth
   5  naif0008.tls                   LSK  Generic LSK
   6  ORMM__040501000000_00076XS.BSP SPK  MEX Orbiter trajectory SPK,
                                          subsetted to cover only time
                                          range of interest
   7  pck00008.tpc                   PCK  Generic PCK
   8  mars_lowres.bds                DSK  Low-resolution Mars DSK
</PRE>
   These SPICE kernels are included in the lesson package available from
   the NAIF server at JPL:
<P>
 
<PRE>
   ftp://naif.jpl.nasa.gov/pub/naif/toolkit_docs/Lessons/
</PRE>
<BR><BR>
<A NAME="CSPICE Modules Used"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> CSPICE Modules Used
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   This section provides a complete list of the functions and kernels that
   are suggested for usage in each of the exercises in this lesson. (You
   may wish to not look at this list unless/until you ``get stuck'' while
   working on your own.)
<P>
 
<PRE>
   CHAPTER EXERCISE   FUNCTIONS  NON-VOID   KERNELS
   ------- ---------  ---------  ---------  ----------
      1    viewpr     <a href="../cspice/furnsh_c.html">furnsh_c</a>   <a href="../cspice/rpd_c.html">rpd_c</a>      1-7
                      <a href="../cspice/str2et_c.html">str2et_c</a>   <a href="../cspice/wncard_c.html">wncard_c</a>
                      <a href="../cspice/timout_c.html">timout_c</a>
                      <a href="../cspice/wninsd_c.html">wninsd_c</a>
                      <a href="../cspice/gfposc_c.html">gfposc_c</a>
                      <a href="../cspice/wnfetd_c.html">wnfetd_c</a>
 
      2    visibl     <a href="../cspice/furnsh_c.html">furnsh_c</a>   <a href="../cspice/rpd_c.html">rpd_c</a>      1-8
                      <a href="../cspice/str2et_c.html">str2et_c</a>   <a href="../cspice/wncard_c.html">wncard_c</a>
                      <a href="../cspice/timout_c.html">timout_c</a>
                      <a href="../cspice/wninsd_c.html">wninsd_c</a>
                      <a href="../cspice/gfposc_c.html">gfposc_c</a>
                      <a href="../cspice/gfoclt_c.html">gfoclt_c</a>
                      <a href="../cspice/wndifd_c.html">wndifd_c</a>
                      <a href="../cspice/wnfetd_c.html">wnfetd_c</a>
 
           extra (*)  <a href="../cspice/repmc_c.html">repmc_c</a>               1,5-7
                      <a href="../cspice/repmf_c.html">repmf_c</a>
                      <a href="../cspice/gfdist_c.html">gfdist_c</a>
                      <a href="../cspice/kclear_c.html">kclear_c</a>
 
 
      (*) Additional APIs and kernels used in Extra Credit tasks.
</PRE>
   Refer to the headers of the various functions listed above, as detailed
   interface specifications are provided with the source code.
<P>
 
<BR><BR>
<A NAME="Find View Periods"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H1> Find View Periods
</H1><HR SIZE=3 NOSHADE><P><BR><BR><BR>
<BR><BR>
<A NAME="Task Statement"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Task Statement
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   Write a program that finds the set of time intervals, within the time
   range
<P>
 
<PRE>
   2004 MAY 2 TDB
   2004 MAY 6 TDB
</PRE>
   when the Mars Express Orbiter (MEX) is visible from the DSN station
   DSS-14. These time intervals are frequently called ``view periods.''
<P>
 
   The spacecraft is considered visible if its apparent position (that is,
   its position corrected for light time and stellar aberration) has
   elevation of at least 6 degrees in the topocentric reference frame
   DSS-14_TOPO. In this exercise, we ignore the possibility of occultation
   of the spacecraft by Mars.
<P>
 
   Use a search step size that ensures that no view periods of duration 5
   minutes or longer will be missed by the search.
<P>
 
   Display the start and stop times of these intervals using TDB calendar
   dates and millisecond precision.
<P>
 
<BR><BR>
<A NAME="Learning Goals"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Learning Goals
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   Exposure to SPICE GF event finding routines. Familiarity with SPICE
   windows and routines that manipulate them. Exposure to SPICE time
   parsing and output formatting routines.
<P>
 
<BR><BR>
<A NAME="Approach"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Approach
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
<BR><BR>
<A NAME="Solution steps"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Solution steps
</H3><P><BR><BR>
   A possible solution could consist of the following steps:
<P>
 
   Preparation:
<P>
 
<UL>
<TT>1.</TT> Review the CSPICE cell and window Required Reading.
<BR><BR></UL>
<UL>
<TT>2.</TT> Decide what SPICE kernels are necessary. Use the SPICE summary tool BRIEF
to examine the coverage of the binary kernels and verify the availability
of required data.
<BR><BR></UL>
<UL>
<TT>3.</TT> Create a meta-kernel listing the SPICE kernels to be loaded. (Hint: consult
a programming example tutorial, or the Introduction to Kernels tutorial,
for a reminder of how to do this.)
<BR><BR></UL>
<UL>
<TT>&#32;&#32;</TT> Name the meta-kernel 'viewpr.tm'.
<BR><BR></UL>
   Next, write a program that performs the following steps:
<P>
 
<UL>
<TT>1.</TT> Use <a href="../cspice/furnsh_c.html">furnsh_c</a> to load the meta-kernel.
<BR><BR></UL>
<UL>
<TT>2.</TT> Declare confinement and output CSPICE windows using SPICEDOUBLE_CELL.
<BR><BR></UL>
<UL>
<TT>3.</TT> Insert the given time bounds into the confinement window using <a href="../cspice/wninsd_c.html">wninsd_c</a>.
<BR><BR></UL>
<UL>
<TT>4.</TT> Select a step size for searching for visibility state transitions: in this
case, each target rise or set event is a state transition.
<BR><BR></UL>
<UL>
<TT>&#32;&#32;</TT> The step size must be large enough so the search proceeds with reasonable
speed, but small enough so that no visibility transition events---that is,
target rise or set events---are missed.
<BR><BR></UL>
<UL>
<TT>5.</TT> Use the GF routine <a href="../cspice/gfposc_c.html">gfposc_c</a> to find the window of times, within the
confinement window, during which the MEX spacecraft is above the elevation
limit as seen from DSN station DSS-14, in the the reference frame
DSS-14_TOPO.
<BR><BR></UL>
<UL>
<TT>&#32;&#32;</TT> Use light time and stellar aberration corrections for the apparent position
of the spacecraft as seen from the station.
<BR><BR></UL>
<UL>
<TT>6.</TT> Fetch and display the contents of the result window. Use <a href="../cspice/wnfetd_c.html">wnfetd_c</a> to
extract from the result window the start and stop times of each time
interval. Display each of the intervals in the result window as a pair of
start and stop times. Express each time as a TDB calendar date using the
routine <a href="../cspice/timout_c.html">timout_c</a>.
<BR><BR></UL>
   You may find it useful to consult the references listed above. In
   particular, the header of the SPICE GF function <a href="../cspice/gfposc_c.html">gfposc_c</a> contains
   pertinent documentation.
<P>
 
<BR><BR>
<A NAME="Solution"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Solution
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
<BR><BR>
<A NAME="Solution Meta-Kernel"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Solution Meta-Kernel
</H3><P><BR><BR>
   The meta-kernel we created for the solution to this exercise is named
   'viewpr.tm'. Its contents follow:
<P>
 
<PRE>
   KPL/MK
 
      Example meta-kernel for geometric event finding hands-on
      coding lesson.
 
         Version 2.0.0 13-JUL-2017 (JDR)
 
      The names and contents of the kernels referenced by this
      meta-kernel are as follows:
 
      File Name                       Description
      ------------------------------  ------------------------------
      de405xs.bsp                     Planetary ephemeris SPK,
                                      subsetted to cover only
                                      time range of interest.
      earthstns_itrf93_050714.bsp     DSN station SPK.
      earth_topo_050714.tf            DSN station frame definitions.
      earth_000101_060525_060303.bpc  Binary PCK for Earth.
      naif0008.tls                    Generic LSK.
      ORMM__040501000000_00076XS.BSP  MEX Orbiter trajectory SPK,
                                      subsetted to cover only
                                      time range of interest.
      pck00008.tpc                    Generic PCK.
 
 
   \begindata
 
      KERNELS_TO_LOAD = (
 
              'kernels/spk/de405xs.bsp'
              'kernels/spk/earthstns_itrf93_050714.bsp'
              'kernels/fk/earth_topo_050714.tf'
              'kernels/pck/earth_000101_060525_060303.bpc'
              'kernels/lsk/naif0008.tls'
              'kernels/spk/ORMM__040501000000_00076XS.BSP'
              'kernels/pck/pck00008.tpc'
                        )
 
   \begintext
</PRE>
<BR><BR>
<A NAME="Solution Code"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Solution Code
</H3><P><BR><BR>
   The example program below shows one possible solution.
<P>
 
<PRE>
   #include &lt;string.h&gt;
   #include &lt;stdio.h&gt;
   #include "SpiceUsr.h"
 
      /*
      PROGRAM VIEWPR
 
      Find and display the window of times when the MEX
      spacecraft is above a specified elevation limit in the
      topocentric reference frame of DSN station DSS-14.
      */
 
   int main()
   {
      /*
      Local constants
      */
 
      /*
      The  meta-kernel:
      */
      #define METAKR          "viewpr.tm"
 
      /*
      Maximum number of intervals in any window:
      */
      #define MAXIVL          1000
 
      /*
      Maximum result window size:
      */
      #define MAXWIN          ( 2 * MAXIVL )
 
      /*
      Format string for time output:
      */
      #define TDBFMT          "YYYY MON DD HR:MN:SC.### (TDB) ::TDB"
 
      /*
      String lengths and other bounds:
      */
      #define LNSIZE          201
      #define TIMLEN          51
 
      /*
      Local variables
      */
 
      /*
      Confinement window used to store interval to be searched:
      */
      SPICEDOUBLE_CELL        ( cnfine, MAXWIN );
 
      /*
      Window to hold sets of times when
      target is above the elevation limit:
      */
      SPICEDOUBLE_CELL        ( riswin, MAXWIN );
 
      SpiceChar             * abcorr;
      SpiceChar             * coord;
      SpiceChar             * crdsys;
      SpiceChar             * obsfrm;
      SpiceChar             * relate;
      SpiceChar             * srfpt;
      SpiceChar             * start;
      SpiceChar             * stop;
      SpiceChar             * target;
      SpiceChar               timstr  [ TIMLEN ];
 
      SpiceDouble             adjust;
      SpiceDouble             elvlim;
      SpiceDouble             etbeg;
      SpiceDouble             etend;
      SpiceDouble             intbeg;
      SpiceDouble             intend;
      SpiceDouble             revlim;
 
      /*
      stepsz is the step size, measured in seconds, used to search
      for times bracketing a state transition.
      */
      SpiceDouble             stepsz;
 
      SpiceInt                i;
      SpiceInt                winsiz;
 
 
      /*
      Load the meta-kernel.
      */
      <a href="../cspice/furnsh_c.html">furnsh_c</a> ( METAKR );
 
      /*
      Assign the inputs for our search.
 
      Since we're interested in the apparent location of the
      target, we use light time and stellar aberration
      corrections. We use the "converged Newtonian" form
      of the light time correction because this choice may
      increase the accuracy of the occultation times we'll
      compute using <a href="../cspice/gfoclt_c.html">gfoclt_c</a>.
      */
      srfpt  = "DSS-14";
      obsfrm = "DSS-14_TOPO";
      target = "MEX";
      abcorr = "CN+S";
      start  = "2004 MAY 2 TDB";
      stop   = "2004 MAY 6 TDB";
      elvlim =  6.0;
 
      /*
      The elevation limit above has units of degrees; we convert
      this value to radians for computation using SPICE routines.
      We'll store the equivalent value in radians in REVLIM.
      */
      revlim = <a href="../cspice/rpd_c.html">rpd_c</a>() * elvlim;
 
      /*
      Since SPICE doesn't directly support the AZ/EL coordinate
      system, we use the equivalent constraint
 
         latitude &gt; REVLIM
 
      in the latitudinal coordinate system, where the reference
      frame is topocentric and is centered at the viewing location.
      */
      crdsys = "LATITUDINAL";
      coord  = "LATITUDE";
      relate = "&gt;";
 
      /*
      The adjustment value only applies to absolute extrema
      searches; simply give it an initial value of zero
      for this inequality search.
      */
      adjust = 0.0;
 
      /*
      STEPSZ is the step size, measured in seconds, used to search
      for times bracketing a state transition. Since we don't expect
      any events of interest to be shorter than five minutes, and
      since the separation between events is well over 5 minutes,
      we'll use this value as our step size. Units are seconds.
      */
      stepsz = 300.0;
 
      /*
      Display a banner for the output report:
      */
      printf ( "\n%s\n\n",
               "Inputs for target visibility search:" );
 
      printf ( "   Target                       = %s\n", target );
      printf ( "   Observation surface location = %s\n", srfpt  );
      printf ( "   Observer's reference frame   = %s\n", obsfrm );
      printf ( "   Elevation limit (degrees)    = %f\n", elvlim );
      printf ( "   Aberration correction        = %s\n", abcorr );
      printf ( "   Step size (seconds)          = %f\n", stepsz );
 
      /*
      Convert the start and stop times to ET.
      */
      <a href="../cspice/str2et_c.html">str2et_c</a> ( start, &amp;etbeg );
      <a href="../cspice/str2et_c.html">str2et_c</a> ( stop,  &amp;etend );
 
      /*
      Display the search interval start and stop times
      using the format shown below.
 
         2004 MAY 06 20:15:00.000 (TDB)
 
      */
      <a href="../cspice/timout_c.html">timout_c</a> ( etbeg, TDBFMT, TIMLEN, timstr );
      printf ( "   Start time                   = %s\n", timstr  );
 
      <a href="../cspice/timout_c.html">timout_c</a> ( etend, TDBFMT, TIMLEN, timstr );
      printf ( "   Stop time                    = %s\n", timstr  );
 
      printf ( "\n" );
 
      /*
      Initialize the "confinement" window with the interval
      over which we'll conduct the search.
      */
      <a href="../cspice/wninsd_c.html">wninsd_c</a> ( etbeg, etend, &amp;cnfine );
 
      /*
      In the call below, the maximum number of window
      intervals <a href="../cspice/gfposc_c.html">gfposc_c</a> can store internally is set to MAXIVL.
 
      Now search for the time period, within our confinement
      window, during which the apparent target has elevation
      at least equal to the elevation limit.
      */
      <a href="../cspice/gfposc_c.html">gfposc_c</a> ( target, obsfrm, abcorr, srfpt,
                 crdsys, coord,  relate, revlim,
                 adjust, stepsz, MAXIVL, &amp;cnfine, &amp;riswin );
 
      /*
      The function <a href="../cspice/wncard_c.html">wncard_c</a> returns the number of intervals
      in a SPICE window.
      */
      winsiz = <a href="../cspice/wncard_c.html">wncard_c</a>( &amp;riswin );
 
      if ( winsiz == 0 )
      {
         printf ( "No events were found.\n" );
      }
      else
      {
         /*
         Display the visibility time periods.
         */
         printf ( "Visibility times of %s as seen from %s:"
                  "\n\n",
                  target, srfpt                               );
 
         for (  i = 0;   i &lt; winsiz;   i++  )
         {
            /*
            Fetch the start and stop times of the Ith interval
            from the search result window riswin.
            */
            <a href="../cspice/wnfetd_c.html">wnfetd_c</a> ( &amp;riswin, i, &amp;intbeg, &amp;intend );
 
            /*
            Convert the rise time to a TDB calendar string.
            */
            <a href="../cspice/timout_c.html">timout_c</a> ( intbeg, TDBFMT, TIMLEN, timstr );
 
            /*
            Write the string to standard output.
            */
            if ( i == 0 )
            {
               printf ( "Visibility or window start time:  %s\n",
                         timstr                                  );
            }
            else
            {
               printf ( "Visibility start time:            %s\n",
                         timstr                                  );
            }
 
            /*
            Convert the set time to a TDB calendar string.
            */
            <a href="../cspice/timout_c.html">timout_c</a> ( intend, TDBFMT, TIMLEN, timstr );
 
            /*
            Write the string to standard output.
            */
            if ( i == winsiz-1 )
            {
               printf ( "Visibility or window stop time:   %s\n",
                         timstr                                  );
            }
            else
            {
               printf ( "Visibility stop time:             %s\n",
                         timstr                                  );
            }
 
            printf ( "\n" );
         }
      }
 
      return ( 0 );
   }
</PRE>
<BR><BR>
<A NAME="Solution Sample Output"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Solution Sample Output
</H3><P><BR><BR>
   Numerical results shown for this example may differ across platforms
   since the results depend on the SPICE kernels used as input and on the
   host platform's arithmetic implementation.
<P>
 
   After compiling the program, execute it. The output is:
<P>
 
<PRE>
 
   Inputs for target visibility search:
 
      Target                       = MEX
      Observation surface location = DSS-14
      Observer's reference frame   = DSS-14_TOPO
      Elevation limit (degrees)    = 6.000000
      Aberration correction        = CN+S
      Step size (seconds)          = 300.000000
      Start time                   = 2004 MAY 02 00:00:00.000 (TDB)
      Stop time                    = 2004 MAY 06 00:00:00.000 (TDB)
 
   Visibility times of MEX as seen from DSS-14:
 
   Visibility or window start time:  2004 MAY 02 00:00:00.000 (TDB)
   Visibility stop time:             2004 MAY 02 05:35:03.096 (TDB)
 
   Visibility start time:            2004 MAY 02 16:09:14.078 (TDB)
   Visibility stop time:             2004 MAY 03 05:33:57.257 (TDB)
 
   Visibility start time:            2004 MAY 03 16:08:02.279 (TDB)
   Visibility stop time:             2004 MAY 04 05:32:50.765 (TDB)
 
   Visibility start time:            2004 MAY 04 16:06:51.259 (TDB)
   Visibility stop time:             2004 MAY 05 05:31:43.600 (TDB)
 
   Visibility start time:            2004 MAY 05 16:05:40.994 (TDB)
   Visibility or window stop time:   2004 MAY 06 00:00:00.000 (TDB)
 
</PRE>
<BR><BR>
<A NAME="Find Times when Target is Visible"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H1> Find Times when Target is Visible
</H1><HR SIZE=3 NOSHADE><P><BR><BR><BR>
<BR><BR>
<A NAME="Task Statement0"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Task Statement
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   Extend the program of the previous chapter to find times when the MEX
   orbiter is:
<P>
 
<UL>
<TT>--</TT> Above the elevation limit in the DSS-14_TOPO topocentric reference frame.
<BR><BR></UL>
<UL>
<TT>--</TT> and is not occulted by Mars
<BR><BR></UL>
   Finding time intervals that satisfy the second condition requires a
   search for occultations of the spacecraft by Mars. Perform this search
   twice: once using an ellipsoidal shape model for Mars, and once using a
   DSK shape model.
<P>
 
   Compute the final results twice as well, using the results of both
   occultation searches.
<P>
 
   For each of the two shape model cases, store the set of time intervals
   when the spacecraft is visible in a CSPICE window. We'll call this the
   ``result window.''
<P>
 
   Display each of the intervals in each result window as a pair of start
   and stop times. Express each time as a TDB calendar date using the same
   format as in the previous program.
<P>
 
<BR><BR>
<A NAME="Learning Goals0"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Learning Goals
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   Familiarity with the GF occultation finding routine <a href="../cspice/gfoclt_c.html">gfoclt_c</a>. Experience
   with Digital Shape Kernel (DSK) shape models. Further experience with
   the CSPICE window functions.
<P>
 
<BR><BR>
<A NAME="Approach0"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Approach
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
<BR><BR>
<A NAME="Solution steps0"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Solution steps
</H3><P><BR><BR>
   A possible solution would consist of the following steps:
<P>
 
<UL>
<TT>1.</TT> Use the meta-kernel from the previous chapter as the starting point. Add
more kernels to it as needed.
<BR><BR></UL>
<UL>
<TT>&#32;&#32;</TT> Name the meta-kernel 'visibl.tm'.
<BR><BR></UL>
<UL>
<TT>2.</TT> Include the code from the program of the previous chapter in a new source
file; modify this code to create the new program.
<BR><BR></UL>
<UL>
<TT>3.</TT> Your program will need additional windows to capture the results of
occultation searches performed using both ellipsoidal and DSK shape models.
Additional windows will be needed to compute the set differences of the
elevation search (``view period'') window and each of the occultation
search windows. Further details are provided below.
<BR><BR></UL>
<UL>
<TT>&#32;&#32;</TT> Declare additional output CSPICE windows using SPICEDOUBLE_CELL.
<BR><BR></UL>
<UL>
<TT>4.</TT> The remaining steps can be performed twice: once using an ellipsoidal shape
model for Mars, and once using a DSK Mars shape model. Alternatively, two
copies of the entire solution program can be created: one for each shape
model.
<BR><BR></UL>
<UL>
<TT>5.</TT> Search for occultations of the MEX orbiter as seen from DSS-14 using
<a href="../cspice/gfoclt_c.html">gfoclt_c</a>. Use as the confinement window for this search the result window
from the elevation search performed by <a href="../cspice/gfposc_c.html">gfposc_c</a>.
<BR><BR></UL>
<UL>
<TT>&#32;&#32;</TT> Since occultations occur when the apparent MEX spacecraft position is
behind the apparent figure of Mars, light time correction must be performed
for the occultation search. To improve accuracy of the occultation state
determination, use ``converged Newtonian'' light time correction.
<BR><BR></UL>
<UL>
<TT>6.</TT> Use the CSPICE window subtraction routine <a href="../cspice/wndifd_c.html">wndifd_c</a> to subtract the window
of times when the spacecraft is occulted from the window of times when the
spacecraft is above the elevation limit. The difference window is the final
result.
<BR><BR></UL>
<UL>
<TT>7.</TT> Modify the code to display the contents of the difference window.
<BR><BR></UL>
   This completes the assignment.
<P>
 
<BR><BR>
<A NAME="Solution0"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Solution
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
<BR><BR>
<A NAME="Solution Meta-Kernel0"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Solution Meta-Kernel
</H3><P><BR><BR>
   The meta-kernel we created for the solution to this exercise is named
   'visibl.tm'. Its contents follow:
<P>
 
<PRE>
   KPL/MK
 
      Example meta-kernel for geometric event finding hands-on
      coding lesson.
 
         Version 3.0.0 26-OCT-2017 (BVS)
 
      The names and contents of the kernels referenced by this
      meta-kernel are as follows:
 
      File Name                       Description
      ------------------------------  ------------------------------
      de405xs.bsp                     Planetary ephemeris SPK,
                                      subsetted to cover only
                                      time range of interest.
      earthstns_itrf93_050714.bsp     DSN station SPK.
      earth_topo_050714.tf            DSN station frame definitions.
      earth_000101_060525_060303.bpc  Binary PCK for Earth.
      naif0008.tls                    Generic LSK.
      ORMM__040501000000_00076XS.BSP  MEX Orbiter trajectory SPK,
                                      subsetted to cover only
                                      time range of interest.
      pck00008.tpc                    Generic PCK.
      mars_lowres.bds                 Low-resolution Mars DSK.
 
 
   \begindata
 
      KERNELS_TO_LOAD = (
 
              'kernels/spk/de405xs.bsp'
              'kernels/spk/earthstns_itrf93_050714.bsp'
              'kernels/fk/earth_topo_050714.tf'
              'kernels/pck/earth_000101_060525_060303.bpc'
              'kernels/lsk/naif0008.tls'
              'kernels/spk/ORMM__040501000000_00076XS.BSP'
              'kernels/pck/pck00008.tpc'
              'kernels/dsk/mars_lowres.bds'
                        )
 
   \begintext
</PRE>
<BR><BR>
<A NAME="Solution Code0"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Solution Code
</H3><P><BR><BR>
<PRE>
 
   #include &lt;string.h&gt;
   #include &lt;stdio.h&gt;
   #include "SpiceUsr.h"
 
      /*
      PROGRAM VISIBL
 
      Find and display the window of times when the MEX
      spacecraft is above a specified elevation limit in the
      topocentric reference frame of DSN station DSS-14
      and is not occulted by Mars.
      */
 
   int main()
   {
      /*
      Local constants
      */
 
      /*
      The  meta-kernel:
      */
      #define METAKR          "visibl.tm"
 
      /*
      Maximum number of intervals in any window:
      */
      #define MAXIVL          1000
 
      /*
      Maximum result window size:
      */
      #define MAXWIN          ( 2 * MAXIVL )
 
      /*
      Format string for time output:
      */
      #define TDBFMT          "YYYY MON DD HR:MN:SC.### TDB ::TDB"
 
      /*
      Time string length:
      */
      #define TIMLEN          29
 
      /*
      Local variables
      */
 
      /*
      Confinement window used to store interval to be searched:
      */
      SPICEDOUBLE_CELL        ( cnfine, MAXWIN );
 
      /*
      Windows to hold sets of times for which
 
         - target is occulted
         - target is above the elevation limit
         - target is visible
 
      Separate ccultation and visibility windows are used
      for ellipsoidal and DSK target shape models.
      */
      SPICEDOUBLE_CELL        ( docwin, MAXWIN );
      SPICEDOUBLE_CELL        ( eocwin, MAXWIN );
      SPICEDOUBLE_CELL        ( riswin, MAXWIN );
      SPICEDOUBLE_CELL        ( dvswin, MAXWIN );
      SPICEDOUBLE_CELL        ( evswin, MAXWIN );
 
      SpiceChar             * abcorr;
      SpiceChar             * back;
      SpiceChar             * bframe;
      SpiceChar             * bshape;
      SpiceChar             * coord;
      SpiceChar             * crdsys;
      SpiceChar             * fframe;
      SpiceChar             * front;
      SpiceChar             * fshape;
      SpiceChar             * obsfrm;
      SpiceChar             * occtyp;
      SpiceChar             * relate;
      SpiceChar             * srfpt;
      SpiceChar             * start;
      SpiceChar             * stop;
      SpiceChar             * target;
      SpiceChar               btmstr [ TIMLEN ];
      SpiceChar               etmstr [ TIMLEN ];
 
      SpiceDouble             adjust;
      SpiceDouble             dintbg;
      SpiceDouble             dinten;
      SpiceDouble             elvlim;
      SpiceDouble             etbeg;
      SpiceDouble             etend;
      SpiceDouble             intbeg;
      SpiceDouble             intend;
      SpiceDouble             revlim;
 
      /*
      stepsz is the step size, measured in seconds, used to search
      for times bracketing a state transition.
      */
      SpiceDouble             stepsz;
 
      SpiceInt                i;
      SpiceInt                winsiz;
 
 
      /*
      Load the meta-kernel.
      */
      <a href="../cspice/furnsh_c.html">furnsh_c</a> ( METAKR );
 
      /*
      Assign the inputs for our search.
 
      Since we're interested in the apparent location of the
      target, we use light time and stellar aberration
      corrections. We use the "converged Newtonian" form
      of the light time correction because this choice may
      increase the accuracy of the occultation times we'll
      compute using <a href="../cspice/gfoclt_c.html">gfoclt_c</a>.
      */
      srfpt  = "DSS-14";
      obsfrm = "DSS-14_TOPO";
      target = "MEX";
      abcorr = "CN+S";
      start  = "2004 MAY 2 TDB";
      stop   = "2004 MAY 6 TDB";
      elvlim =  6.0;
 
      /*
      The elevation limit above has units of degrees; we convert
      this value to radians for computation using SPICE routines.
      We'll store the equivalent value in radians in REVLIM.
      */
      revlim = <a href="../cspice/rpd_c.html">rpd_c</a>() * elvlim;
 
      /*
      We model the target shape as a point.
 
      We model the target shape as a point. We either model the
      blocking body's shape as an ellipsoid, or we represent
      its shape using actual topographic data. No body-fixed
      reference frame is required for the target since its
      orientation is not used.
      */
      back   = target;
      bshape = "POINT";
      bframe = " ";
      front  = "MARS";
      fframe = "IAU_MARS";
 
      /*
      The occultation type should be set to "ANY" for a point
      target.
      */
      occtyp = "any";
 
      /*
      Since SPICE doesn't directly support the AZ/EL coordinate
      system, we use the equivalent constraint
 
         latitude &gt; REVLIM
 
      in the latitudinal coordinate system, where the reference
      frame is topocentric and is centered at the viewing location.
      */
      crdsys = "LATITUDINAL";
      coord  = "LATITUDE";
      relate = "&gt;";
 
      /*
      The adjustment value only applies to absolute extrema
      searches; simply give it an initial value of zero
      for this inequality search.
      */
      adjust = 0.0;
 
      /*
      STEPSZ is the step size, measured in seconds, used to search
      for times bracketing a state transition. Since we don't expect
      any events of interest to be shorter than five minutes, and
      since the separation between events is well over 5 minutes,
      we'll use this value as our step size. Units are seconds.
      */
      stepsz = 300.0;
 
      /*
      Display a banner for the output report:
      */
      printf ( "\n%s\n\n",
               "Inputs for target visibility search:" );
 
      printf ( "   Target                       = %s\n", target );
      printf ( "   Observation surface location = %s\n", srfpt  );
      printf ( "   Observer's reference frame   = %s\n", obsfrm );
      printf ( "   Blocking body                = %s\n", front  );
      printf ( "   Blocker's reference frame    = %s\n", fframe );
      printf ( "   Elevation limit (degrees)    = %f\n", elvlim );
      printf ( "   Aberration correction        = %s\n", abcorr );
      printf ( "   Step size (seconds)          = %f\n", stepsz );
 
      /*
      Convert the start and stop times to ET.
      */
      <a href="../cspice/str2et_c.html">str2et_c</a> ( start, &amp;etbeg );
      <a href="../cspice/str2et_c.html">str2et_c</a> ( stop,  &amp;etend );
 
      /*
      Display the search interval start and stop times
      using the format shown below.
 
         2004 MAY 06 20:15:00.000 (TDB)
      */
      <a href="../cspice/timout_c.html">timout_c</a> ( etbeg, TDBFMT, TIMLEN, btmstr );
      printf ( "   Start time                   = %s\n", btmstr  );
 
      <a href="../cspice/timout_c.html">timout_c</a> ( etend, TDBFMT, TIMLEN, etmstr );
      printf ( "   Stop time                    = %s\n", etmstr  );
 
      printf ( "\n" );
 
      /*
      Initialize the "confinement" window with the interval
      over which we'll conduct the search.
      */
      <a href="../cspice/wninsd_c.html">wninsd_c</a> ( etbeg, etend, &amp;cnfine );
 
      /*
      In the call below, the maximum number of window
      intervals <a href="../cspice/gfposc_c.html">gfposc_c</a> can store internally is set to MAXIVL.
 
      Now search for the time period, within our confinement
      window, during which the apparent target has elevation
      at least equal to the elevation limit.
      */
      <a href="../cspice/gfposc_c.html">gfposc_c</a> ( target, obsfrm, abcorr, srfpt,
                 crdsys, coord,  relate, revlim,
                 adjust, stepsz, MAXIVL, &amp;cnfine, &amp;riswin );
 
      /*
      Now find the times when the apparent target is above
      the elevation limit and is not occulted by the
      blocking body (Mars). We'll find the window of times when
      the target is above the elevation limit and *is* occulted,
      then subtract that window from the view period window
      riswin found above.
 
      For this occultation search, we can use riswin as
      the confinement window because we're not interested in
      occultations that occur when the target is below the
      elevation limit.
 
      Find occultations within the view period window.
      */
      printf ( " Searching using ellipsoid target shape model...\n" );
 
      fshape = "ELLIPSOID";
 
      <a href="../cspice/gfoclt_c.html">gfoclt_c</a> ( occtyp, front,  fshape,  fframe,
                 back,   bshape, bframe,  abcorr,
                 srfpt,  stepsz, &amp;riswin, &amp;eocwin );
 
      printf ( " Done.\n" );
 
      /*
      Subtract the occultation window from the view period
      window: this yields the time periods when the target
      is visible.
      */
      <a href="../cspice/wndifd_c.html">wndifd_c</a> ( &amp;riswin, &amp;eocwin, &amp;evswin );
 
      /*
      Repeat the search using low-resolution DSK data
      for the front body.
      */
      printf ( " Searching using DSK target shape model...\n" );
 
      fshape = "DSK/UNPRIORITIZED";
 
      <a href="../cspice/gfoclt_c.html">gfoclt_c</a> ( occtyp, front,  fshape,  fframe,
                 back,   bshape, bframe,  abcorr,
                 srfpt,  stepsz, &amp;riswin, &amp;docwin );
 
      printf ( " Done.\n" );
 
      <a href="../cspice/wndifd_c.html">wndifd_c</a> ( &amp;riswin, &amp;docwin, &amp;dvswin );
 
 
      /*
      The function <a href="../cspice/wncard_c.html">wncard_c</a> returns the number of intervals
      in a SPICE window.
      */
      winsiz = <a href="../cspice/wncard_c.html">wncard_c</a>( &amp;evswin );
 
      if ( winsiz == 0 )
      {
         printf ( "No events were found.\n" );
      }
      else
      {
         /*
         Display the visibility time periods.
         */
         printf ( "\nVisibility start and stop times of "
                  "%s as seen from %s\n"
                  "using both ellipsoidal and DSK "
                  "target shape models:"
                  "\n\n",
                  target, srfpt                       );
 
         for (  i = 0;   i &lt; winsiz;   i++  )
         {
            /*
            Fetch the start and stop times of the Ith interval
            from the ellipsoid search result window evswin.
            */
            <a href="../cspice/wnfetd_c.html">wnfetd_c</a> ( &amp;evswin, i, &amp;intbeg, &amp;intend );
 
            /*
            Convert the start and stop times to TDB calendar
            strings. Write the results.
            */
            <a href="../cspice/timout_c.html">timout_c</a> ( intbeg, TDBFMT, TIMLEN, btmstr );
            <a href="../cspice/timout_c.html">timout_c</a> ( intend, TDBFMT, TIMLEN, etmstr );
 
            printf ( " Ell: %s : %s\n", btmstr, etmstr );
 
            /*
            Fetch the start and stop times of the Ith interval
            from the DSK search result window dvswin.
            */
            <a href="../cspice/wnfetd_c.html">wnfetd_c</a> ( &amp;dvswin, i, &amp;dintbg, &amp;dinten );
 
            /*
            Convert the start and stop times to TDB calendar
            strings. Write the results.
            */
            <a href="../cspice/timout_c.html">timout_c</a> ( dintbg, TDBFMT, TIMLEN, btmstr );
            <a href="../cspice/timout_c.html">timout_c</a> ( dinten, TDBFMT, TIMLEN, etmstr );
 
            printf ( " DSK: %s : %s\n", btmstr, etmstr );
 
            printf ( "\n" );
         }
      }
 
      return ( 0 );
   }
</PRE>
<BR><BR>
<A NAME="Solution Sample Output0"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Solution Sample Output
</H3><P><BR><BR>
   Numerical results shown for this example may differ across platforms
   since the results depend on the SPICE kernels used as input and on the
   host platform's arithmetic implementation.
<P>
 
   After compiling the program, execute it. The output is:
<P>
 
<PRE>
 
   Inputs for target visibility search:
 
      Target                       = MEX
      Observation surface location = DSS-14
      Observer's reference frame   = DSS-14_TOPO
      Blocking body                = MARS
      Blocker's reference frame    = IAU_MARS
      Elevation limit (degrees)    = 6.000000
      Aberration correction        = CN+S
      Step size (seconds)          = 300.000000
      Start time                   = 2004 MAY 02 00:00:00.000 TDB
      Stop time                    = 2004 MAY 06 00:00:00.000 TDB
 
    Searching using ellipsoid target shape model...
    Done.
    Searching using DSK target shape model...
    Done.
 
   Visibility start and stop times of MEX as seen from DSS-14
   using both ellipsoidal and DSK target shape models:
 
    Ell: 2004 MAY 02 00:00:00.000 TDB : 2004 MAY 02 04:49:30.827 TDB
    DSK: 2004 MAY 02 00:00:00.000 TDB : 2004 MAY 02 04:49:32.645 TDB
 
    Ell: 2004 MAY 02 16:09:14.078 TDB : 2004 MAY 02 20:00:22.514 TDB
    DSK: 2004 MAY 02 16:09:14.078 TDB : 2004 MAY 02 20:00:23.980 TDB
 
    Ell: 2004 MAY 02 21:01:38.222 TDB : 2004 MAY 03 03:35:42.256 TDB
    DSK: 2004 MAY 02 21:01:43.195 TDB : 2004 MAY 03 03:35:44.140 TDB
 
    Ell: 2004 MAY 03 04:36:42.484 TDB : 2004 MAY 03 05:33:57.257 TDB
    DSK: 2004 MAY 03 04:36:46.856 TDB : 2004 MAY 03 05:33:57.257 TDB
 
    Ell: 2004 MAY 03 16:08:02.279 TDB : 2004 MAY 03 18:46:26.013 TDB
    DSK: 2004 MAY 03 16:08:02.279 TDB : 2004 MAY 03 18:46:27.306 TDB
 
    Ell: 2004 MAY 03 19:46:54.618 TDB : 2004 MAY 04 02:21:44.562 TDB
    DSK: 2004 MAY 03 19:46:59.723 TDB : 2004 MAY 04 02:21:46.574 TDB
 
    Ell: 2004 MAY 04 03:21:56.347 TDB : 2004 MAY 04 05:32:50.765 TDB
    DSK: 2004 MAY 04 03:22:00.850 TDB : 2004 MAY 04 05:32:50.765 TDB
 
    Ell: 2004 MAY 04 16:06:51.259 TDB : 2004 MAY 04 17:32:25.809 TDB
    DSK: 2004 MAY 04 16:06:51.259 TDB : 2004 MAY 04 17:32:27.118 TDB
 
    Ell: 2004 MAY 04 18:32:05.975 TDB : 2004 MAY 05 01:07:48.264 TDB
    DSK: 2004 MAY 04 18:32:11.046 TDB : 2004 MAY 05 01:07:50.061 TDB
 
    Ell: 2004 MAY 05 02:07:11.601 TDB : 2004 MAY 05 05:31:43.600 TDB
    DSK: 2004 MAY 05 02:07:16.241 TDB : 2004 MAY 05 05:31:43.600 TDB
 
    Ell: 2004 MAY 05 16:05:40.994 TDB : 2004 MAY 05 16:18:35.560 TDB
    DSK: 2004 MAY 05 16:05:40.994 TDB : 2004 MAY 05 16:18:36.994 TDB
 
    Ell: 2004 MAY 05 17:17:27.717 TDB : 2004 MAY 05 23:54:04.672 TDB
    DSK: 2004 MAY 05 17:17:32.375 TDB : 2004 MAY 05 23:54:06.221 TDB
 
</PRE>
<BR><BR>
<A NAME="Extra Credit"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H1> Extra Credit
</H1><HR SIZE=3 NOSHADE><P><BR><BR><BR>
   In this ``extra credit'' section you will be presented with more complex
   tasks, aimed at improving your understanding of the geometry event
   finding subsystem and particularly the <a href="../cspice/gfposc_c.html">gfposc_c</a> and <a href="../cspice/gfdist_c.html">gfdist_c</a> functions.
<P>
 
   These ``extra credit'' tasks are provided as task statements, and unlike
   the regular tasks, no approach or solution source code is provided. In
   the next section, you will find the numeric solutions to the questions
   asked in these tasks.
<P>
 
<BR><BR>
<A NAME="Task statements"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Task statements
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
<UL>
<TT>1.</TT> Write a program that finds the times, within the time range
<BR><BR></UL>
<PRE>
         2004 MAY 2 TDB
         2004 MAY 6 TDB
</PRE>
<UL>
<TT>&#32;&#32;</TT> when the MEX spacecraft crosses Mars' equator. Display the results using
TDB calendar dates and millisecond precision.
<BR><BR></UL>
<UL>
<TT>2.</TT> Write a program that finds the times, within the time range
<BR><BR></UL>
<PRE>
         2004 MAY 2 TDB
         2004 MAY 6 TDB
</PRE>
<UL>
<TT>&#32;&#32;</TT> when the MEX spacecraft is at periapsis. Display the results using TDB
calendar dates and millisecond precision.
<BR><BR></UL>
<UL>
<TT>3.</TT> Write a program that finds the times, within the time range
<BR><BR></UL>
<PRE>
         2004 MAY 2 TDB
         2004 MAY 6 TDB
</PRE>
<UL>
<TT>&#32;&#32;</TT> when the MEX spacecraft is at apoapsis. Display the results using TDB
calendar dates and millisecond precision.
<BR><BR></UL>
<BR><BR>
<A NAME="Solutions"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Solutions
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
<UL>
<TT>1.</TT> Solution for the equator crossing search, using <a href="../cspice/gfposc_c.html">gfposc_c</a> for the MEX
spacecraft latitude in the Mars body-fixed frame equal to 0 degrees:
<BR><BR></UL>
<PRE>
 
   Inputs for equator crossing search:
 
      Target                       = MEX
      Observer                     = MARS
      Observer's reference frame   = IAU_MARS
      Latitude limit (degrees)     = 0.000000
      Aberration correction        = NONE
      Step size (seconds)          = 300.000000
      Start time                   = 2004 MAY 02 00:00:00.000 (TDB)
      Stop time                    = 2004 MAY 06 00:00:00.000 (TDB)
 
   MEX MARS equator crossing times:
 
    Equator crossing or start time:  2004 MAY 02 05:00:08.334 (TDB)
    Equator crossing time:           2004 MAY 02 06:15:13.074 (TDB)
    Equator crossing time:           2004 MAY 02 12:35:14.856 (TDB)
    Equator crossing time:           2004 MAY 02 13:50:09.161 (TDB)
    Equator crossing time:           2004 MAY 02 20:10:24.439 (TDB)
    Equator crossing time:           2004 MAY 02 21:25:10.344 (TDB)
    Equator crossing time:           2004 MAY 03 03:45:26.758 (TDB)
    Equator crossing time:           2004 MAY 03 05:00:04.086 (TDB)
    Equator crossing time:           2004 MAY 03 11:20:32.419 (TDB)
    Equator crossing time:           2004 MAY 03 12:34:57.968 (TDB)
    Equator crossing time:           2004 MAY 03 18:55:34.883 (TDB)
    Equator crossing time:           2004 MAY 03 20:09:53.063 (TDB)
    Equator crossing time:           2004 MAY 04 02:30:35.509 (TDB)
    Equator crossing time:           2004 MAY 04 03:44:42.753 (TDB)
    Equator crossing time:           2004 MAY 04 10:05:41.638 (TDB)
    Equator crossing time:           2004 MAY 04 11:19:38.397 (TDB)
    Equator crossing time:           2004 MAY 04 17:40:41.405 (TDB)
    Equator crossing time:           2004 MAY 04 18:54:31.413 (TDB)
    Equator crossing time:           2004 MAY 05 01:15:45.967 (TDB)
    Equator crossing time:           2004 MAY 05 02:29:25.294 (TDB)
    Equator crossing time:           2004 MAY 05 08:50:53.931 (TDB)
    Equator crossing time:           2004 MAY 05 10:04:26.915 (TDB)
    Equator crossing time:           2004 MAY 05 16:25:58.350 (TDB)
    Equator crossing or stop time:   2004 MAY 05 17:39:23.889 (TDB)
</PRE>
<UL>
<TT>2.</TT> Solution for the periapsis search, using <a href="../cspice/gfdist_c.html">gfdist_c</a> for the MEX spacecraft
distance from Mars at a local minimum:
<BR><BR></UL>
<PRE>
 
   Inputs for periapsis search:
 
      Target                       = MEX
      Observer                     = MARS
      Aberration correction        = NONE
      Step size (seconds)          = 300.000000
      Start time                   = 2004 MAY 02 00:00:00.000 (TDB)
      Stop time                    = 2004 MAY 06 00:00:00.000 (TDB)
 
   MEX periapsis times:
 
    Periapsis or start time:         2004 MAY 02 05:57:51.000 (TDB)
    Periapsis time:                  2004 MAY 02 13:32:43.325 (TDB)
    Periapsis time:                  2004 MAY 02 21:07:41.124 (TDB)
    Periapsis time:                  2004 MAY 03 04:42:30.648 (TDB)
    Periapsis time:                  2004 MAY 03 12:17:21.143 (TDB)
    Periapsis time:                  2004 MAY 03 19:52:12.267 (TDB)
    Periapsis time:                  2004 MAY 04 03:26:57.755 (TDB)
    Periapsis time:                  2004 MAY 04 11:01:49.826 (TDB)
    Periapsis time:                  2004 MAY 04 18:36:38.448 (TDB)
    Periapsis time:                  2004 MAY 05 02:11:28.558 (TDB)
    Periapsis time:                  2004 MAY 05 09:46:26.309 (TDB)
    Periapsis or end time:           2004 MAY 05 17:21:18.875 (TDB)
</PRE>
<UL>
<TT>3.</TT> Solution for the apoapsis search, using <a href="../cspice/gfdist_c.html">gfdist_c</a> for the MEX spacecraft
distance from Mars at a local maximum:
<BR><BR></UL>
<PRE>
 
   Inputs for apoapsis search:
 
      Target                       = MEX
      Observer                     = MARS
      Aberration correction        = NONE
      Step size (seconds)          = 300.000000
      Start time                   = 2004 MAY 02 00:00:00.000 (TDB)
      Stop time                    = 2004 MAY 06 00:00:00.000 (TDB)
 
   MEX apoapsis times:
 
    Apoapsis or start time:          2004 MAY 02 02:10:24.948 (TDB)
    Apoapsis time:                   2004 MAY 02 09:45:19.189 (TDB)
    Apoapsis time:                   2004 MAY 02 17:20:14.194 (TDB)
    Apoapsis time:                   2004 MAY 03 00:55:07.633 (TDB)
    Apoapsis time:                   2004 MAY 03 08:29:57.890 (TDB)
    Apoapsis time:                   2004 MAY 03 16:04:48.524 (TDB)
    Apoapsis time:                   2004 MAY 03 23:39:36.745 (TDB)
    Apoapsis time:                   2004 MAY 04 07:14:25.662 (TDB)
    Apoapsis time:                   2004 MAY 04 14:49:15.904 (TDB)
    Apoapsis time:                   2004 MAY 04 22:24:05.351 (TDB)
    Apoapsis time:                   2004 MAY 05 05:58:59.270 (TDB)
    Apoapsis time:                   2004 MAY 05 13:33:54.433 (TDB)
    Apoapsis or stop time:           2004 MAY 05 21:08:50.211 (TDB)
</PRE>

</TD>
</TR>
</TBODY>
</TABLE>

</BODY>

</HTML>
